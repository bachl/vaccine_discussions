<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 3 Data collection | Supplementary Materials for “Vaccine-related Discussions in Online Communities for Parents”</title>
  <meta name="description" content="We provide some supplementary materials, including documentation on data collection, model selection, and an overview of all topics" />
  <meta name="generator" content="bookdown 0.16 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 3 Data collection | Supplementary Materials for “Vaccine-related Discussions in Online Communities for Parents”" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="We provide some supplementary materials, including documentation on data collection, model selection, and an overview of all topics" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 3 Data collection | Supplementary Materials for “Vaccine-related Discussions in Online Communities for Parents”" />
  
  <meta name="twitter:description" content="We provide some supplementary materials, including documentation on data collection, model selection, and an overview of all topics" />
  

<meta name="author" content="Marko Bachl &amp; Elena Link" />


<meta name="date" content="2020-02-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="selection-of-online-communities.html"/>
<link rel="next" href="data-selection.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Supplementary Materials</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#r-packages"><i class="fa fa-check"></i><b>1.1</b> R packages</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#osf-repository"><i class="fa fa-check"></i><b>1.2</b> OSF repository</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="selection-of-online-communities.html"><a href="selection-of-online-communities.html"><i class="fa fa-check"></i><b>2</b> Selection of online communities</a></li>
<li class="chapter" data-level="3" data-path="data-collection.html"><a href="data-collection.html"><i class="fa fa-check"></i><b>3</b> Data collection</a><ul>
<li class="chapter" data-level="3.1" data-path="data-collection.html"><a href="data-collection.html#urbia"><i class="fa fa-check"></i><b>3.1</b> Urbia</a><ul>
<li class="chapter" data-level="3.1.1" data-path="data-collection.html"><a href="data-collection.html#search"><i class="fa fa-check"></i><b>3.1.1</b> Search</a></li>
<li class="chapter" data-level="3.1.2" data-path="data-collection.html"><a href="data-collection.html#collection"><i class="fa fa-check"></i><b>3.1.2</b> Collection</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="data-collection.html"><a href="data-collection.html#rund-ums-baby"><i class="fa fa-check"></i><b>3.2</b> Rund ums Baby</a><ul>
<li class="chapter" data-level="3.2.1" data-path="data-collection.html"><a href="data-collection.html#search-1"><i class="fa fa-check"></i><b>3.2.1</b> Search</a></li>
<li class="chapter" data-level="3.2.2" data-path="data-collection.html"><a href="data-collection.html#collection-1"><i class="fa fa-check"></i><b>3.2.2</b> Collection</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="data-collection.html"><a href="data-collection.html#netmoms"><i class="fa fa-check"></i><b>3.3</b> Netmoms</a><ul>
<li class="chapter" data-level="3.3.1" data-path="data-collection.html"><a href="data-collection.html#search-2"><i class="fa fa-check"></i><b>3.3.1</b> Search</a></li>
<li class="chapter" data-level="3.3.2" data-path="data-collection.html"><a href="data-collection.html#collection-2"><i class="fa fa-check"></i><b>3.3.2</b> Collection</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="data-collection.html"><a href="data-collection.html#babycenter"><i class="fa fa-check"></i><b>3.4</b> Babycenter</a><ul>
<li class="chapter" data-level="3.4.1" data-path="data-collection.html"><a href="data-collection.html#search-3"><i class="fa fa-check"></i><b>3.4.1</b> Search</a></li>
<li class="chapter" data-level="3.4.2" data-path="data-collection.html"><a href="data-collection.html#collection-3"><i class="fa fa-check"></i><b>3.4.2</b> Collection</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data-selection.html"><a href="data-selection.html"><i class="fa fa-check"></i><b>4</b> Data selection</a></li>
<li class="chapter" data-level="5" data-path="data-preparation.html"><a href="data-preparation.html"><i class="fa fa-check"></i><b>5</b> Data preparation</a></li>
<li class="chapter" data-level="6" data-path="model-estimation-comparison-and-selection.html"><a href="model-estimation-comparison-and-selection.html"><i class="fa fa-check"></i><b>6</b> Model estimation, comparison, and selection</a><ul>
<li class="chapter" data-level="6.1" data-path="model-estimation-comparison-and-selection.html"><a href="model-estimation-comparison-and-selection.html#model-estimation"><i class="fa fa-check"></i><b>6.1</b> Model estimation</a></li>
<li class="chapter" data-level="6.2" data-path="model-estimation-comparison-and-selection.html"><a href="model-estimation-comparison-and-selection.html#model-comparison"><i class="fa fa-check"></i><b>6.2</b> Model comparison</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="cluster-analysis-of-topic-co-occurence.html"><a href="cluster-analysis-of-topic-co-occurence.html"><i class="fa fa-check"></i><b>7</b> Cluster analysis of topic co-occurence</a></li>
<li class="chapter" data-level="8" data-path="replication-code-for-figure-1.html"><a href="replication-code-for-figure-1.html"><i class="fa fa-check"></i><b>8</b> Replication code for Figure 1</a></li>
<li class="chapter" data-level="9" data-path="topic-description.html"><a href="topic-description.html"><i class="fa fa-check"></i><b>9</b> Topic description</a><ul>
<li class="chapter" data-level="9.1" data-path="topic-description.html"><a href="topic-description.html#topic-1-child-development"><i class="fa fa-check"></i><b>9.1</b> Topic 1: Child development</a></li>
<li class="chapter" data-level="9.2" data-path="topic-description.html"><a href="topic-description.html#topic-2-influenza"><i class="fa fa-check"></i><b>9.2</b> Topic 2: Influenza</a></li>
<li class="chapter" data-level="9.3" data-path="topic-description.html"><a href="topic-description.html#topic-3-information-sources"><i class="fa fa-check"></i><b>9.3</b> Topic 3: Information sources</a></li>
<li class="chapter" data-level="9.4" data-path="topic-description.html"><a href="topic-description.html#topic-4-recovery-wishes"><i class="fa fa-check"></i><b>9.4</b> Topic 4: Recovery wishes</a></li>
<li class="chapter" data-level="9.5" data-path="topic-description.html"><a href="topic-description.html#topic-5-experience-report"><i class="fa fa-check"></i><b>9.5</b> Topic 5: Experience report</a></li>
<li class="chapter" data-level="9.6" data-path="topic-description.html"><a href="topic-description.html#topic-6-chickenpox"><i class="fa fa-check"></i><b>9.6</b> Topic 6: Chickenpox</a></li>
<li class="chapter" data-level="9.7" data-path="topic-description.html"><a href="topic-description.html#topic-7-compulsory-vaccination"><i class="fa fa-check"></i><b>9.7</b> Topic 7: Compulsory vaccination</a></li>
<li class="chapter" data-level="9.8" data-path="topic-description.html"><a href="topic-description.html#topic-8-immunity-pregnancy"><i class="fa fa-check"></i><b>9.8</b> Topic 8: Immunity pregnancy</a></li>
<li class="chapter" data-level="9.9" data-path="topic-description.html"><a href="topic-description.html#topic-9-tbe"><i class="fa fa-check"></i><b>9.9</b> Topic 9: TBE</a></li>
<li class="chapter" data-level="9.10" data-path="topic-description.html"><a href="topic-description.html#topic-10-tolerability"><i class="fa fa-check"></i><b>9.10</b> Topic 10: Tolerability</a></li>
<li class="chapter" data-level="9.11" data-path="topic-description.html"><a href="topic-description.html#topic-11-booster-dose"><i class="fa fa-check"></i><b>9.11</b> Topic 11: Booster dose</a></li>
<li class="chapter" data-level="9.12" data-path="topic-description.html"><a href="topic-description.html#topic-12-meningococcal"><i class="fa fa-check"></i><b>9.12</b> Topic 12: Meningococcal</a></li>
<li class="chapter" data-level="9.13" data-path="topic-description.html"><a href="topic-description.html#topic-13-requests"><i class="fa fa-check"></i><b>9.13</b> Topic 13: Requests</a></li>
<li class="chapter" data-level="9.14" data-path="topic-description.html"><a href="topic-description.html#topic-14-evidence-base"><i class="fa fa-check"></i><b>9.14</b> Topic 14: Evidence base</a></li>
<li class="chapter" data-level="9.15" data-path="topic-description.html"><a href="topic-description.html#topic-15-acknowledgements"><i class="fa fa-check"></i><b>9.15</b> Topic 15: Acknowledgements</a></li>
<li class="chapter" data-level="9.16" data-path="topic-description.html"><a href="topic-description.html#topic-16-body-measurements"><i class="fa fa-check"></i><b>9.16</b> Topic 16: Body measurements</a></li>
<li class="chapter" data-level="9.17" data-path="topic-description.html"><a href="topic-description.html#topic-17-fever"><i class="fa fa-check"></i><b>9.17</b> Topic 17: Fever</a></li>
<li class="chapter" data-level="9.18" data-path="topic-description.html"><a href="topic-description.html#topic-18-eating"><i class="fa fa-check"></i><b>9.18</b> Topic 18: Eating</a></li>
<li class="chapter" data-level="9.19" data-path="topic-description.html"><a href="topic-description.html#topic-19-work"><i class="fa fa-check"></i><b>9.19</b> Topic 19: Work</a></li>
<li class="chapter" data-level="9.20" data-path="topic-description.html"><a href="topic-description.html#topic-20-vaccination-decision"><i class="fa fa-check"></i><b>9.20</b> Topic 20: Vaccination decision</a></li>
<li class="chapter" data-level="9.21" data-path="topic-description.html"><a href="topic-description.html#topic-21-vaccination-timetable"><i class="fa fa-check"></i><b>9.21</b> Topic 21: Vaccination timetable</a></li>
<li class="chapter" data-level="9.22" data-path="topic-description.html"><a href="topic-description.html#topic-22-bad-experiences"><i class="fa fa-check"></i><b>9.22</b> Topic 22: Bad experiences</a></li>
<li class="chapter" data-level="9.23" data-path="topic-description.html"><a href="topic-description.html#topic-23-measles-and-mumps"><i class="fa fa-check"></i><b>9.23</b> Topic 23: Measles and mumps</a></li>
<li class="chapter" data-level="9.24" data-path="topic-description.html"><a href="topic-description.html#topic-24-appointments"><i class="fa fa-check"></i><b>9.24</b> Topic 24: Appointments</a></li>
<li class="chapter" data-level="9.25" data-path="topic-description.html"><a href="topic-description.html#topic-25-procedural-issues"><i class="fa fa-check"></i><b>9.25</b> Topic 25: Procedural issues</a></li>
<li class="chapter" data-level="9.26" data-path="topic-description.html"><a href="topic-description.html#topic-26-sleep"><i class="fa fa-check"></i><b>9.26</b> Topic 26: Sleep</a></li>
<li class="chapter" data-level="9.27" data-path="topic-description.html"><a href="topic-description.html#topic-27-vaccine-ingredients"><i class="fa fa-check"></i><b>9.27</b> Topic 27: Vaccine ingredients</a></li>
<li class="chapter" data-level="9.28" data-path="topic-description.html"><a href="topic-description.html#topic-28-immediate-reactions"><i class="fa fa-check"></i><b>9.28</b> Topic 28: Immediate reactions</a></li>
<li class="chapter" data-level="9.29" data-path="topic-description.html"><a href="topic-description.html#topic-29-daily-coping"><i class="fa fa-check"></i><b>9.29</b> Topic 29: Daily coping</a></li>
<li class="chapter" data-level="9.30" data-path="topic-description.html"><a href="topic-description.html#topic-30-discussion-tone"><i class="fa fa-check"></i><b>9.30</b> Topic 30: Discussion tone</a></li>
<li class="chapter" data-level="9.31" data-path="topic-description.html"><a href="topic-description.html#topic-31-vaccination-sequence"><i class="fa fa-check"></i><b>9.31</b> Topic 31: Vaccination sequence</a></li>
<li class="chapter" data-level="9.32" data-path="topic-description.html"><a href="topic-description.html#topic-32-responsibility-and-threats"><i class="fa fa-check"></i><b>9.32</b> Topic 32: Responsibility and threats</a></li>
<li class="chapter" data-level="9.33" data-path="topic-description.html"><a href="topic-description.html#topic-33-conversation-style"><i class="fa fa-check"></i><b>9.33</b> Topic 33: Conversation style</a></li>
<li class="chapter" data-level="9.34" data-path="topic-description.html"><a href="topic-description.html#topic-34-medical-advice"><i class="fa fa-check"></i><b>9.34</b> Topic 34: Medical advice</a></li>
<li class="chapter" data-level="9.35" data-path="topic-description.html"><a href="topic-description.html#topic-35-conversation-style-ii"><i class="fa fa-check"></i><b>9.35</b> Topic 35: Conversation style II</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Supplementary Materials for “Vaccine-related Discussions in Online Communities for Parents”</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-collection" class="section level1">
<h1><span class="header-section-number">Section 3</span> Data collection</h1>
<p>The data were collected using custom search and scraping scripts for each online community. The general approach was similiar for all four communities. A first script used the search function of the community to collect all links to threads which contained the term <em>impf</em> (roughly equivalent to the search term “vaccin” in English texts) in at least one post. The second script visited these links, scraped the relevant information, and saved them in a structured format. The subsequent sections present some excerpts from these script. Please note that the data collection is not perfectly reproducible, because both the content and the structure of the online communities may change over time. We therefore did not aim to provide a fully reproducible script, but document our basic scraping functions.</p>
<div id="urbia" class="section level2">
<h2><span class="header-section-number">3.1</span> Urbia</h2>
<div id="search" class="section level3">
<h3><span class="header-section-number">3.1.1</span> Search</h3>
<p>The search script for Urbia used <a href="https://phantomjs.org/">phantomJS</a> to render the search results. The first <em>R</em> function creates a java script call, which is then called from within <em>R</em> (inspired by this <a href="https://www.datacamp.com/community/tutorials/scraping-javascript-generated-data-with-r">source</a>).</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">create_js =<span class="st"> </span><span class="cf">function</span>(<span class="dt">search_term =</span> <span class="st">&quot;impf&quot;</span>, page_number, <span class="dt">file_name =</span> <span class="st">&quot;tmp.js&quot;</span>) {</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">    txt =<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="st">var webPage = require(&#39;webpage&#39;);</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="st">var page = webPage.create();</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="st">var fs = require(&#39;fs&#39;);</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="st">var path = &#39;urbia_search.html&#39;</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="st">page.open(&#39;https://m.urbia.de/services/search?q=&quot;</span>, </a>
<a class="sourceLine" id="cb1-10" data-line-number="10">        search_term, <span class="st">&quot;#q=&quot;</span>, search_term, <span class="st">&quot;&amp;label=forum&amp;sort=date&amp;board=&amp;start=&quot;</span>, </a>
<a class="sourceLine" id="cb1-11" data-line-number="11">        page_number, <span class="st">&quot;&#39;, function (status) {</span></a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="st">  var content = page.content;</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="st">  fs.write(path,content,&#39;w&#39;)</span></a>
<a class="sourceLine" id="cb1-14" data-line-number="14"><span class="st">  phantom.exit();</span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15"><span class="st">});</span></a>
<a class="sourceLine" id="cb1-16" data-line-number="16"></a>
<a class="sourceLine" id="cb1-17" data-line-number="17"><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb1-18" data-line-number="18">    <span class="kw">write_file</span>(txt, file_name)</a>
<a class="sourceLine" id="cb1-19" data-line-number="19">}</a></code></pre></div>
<p>The search function is called once to identify the number of result pages.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">create_js</span>(<span class="dt">page_number =</span> <span class="st">&quot;1&quot;</span>)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw">system</span>(<span class="st">&quot;phantomjs-2.1.1-macosx/bin/phantomjs tmp.js&quot;</span>)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">n_hits =<span class="st"> </span><span class="kw">read_html</span>(<span class="st">&quot;urbia_search.html&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;#results-amount&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="st">    </span><span class="kw">html_text</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_remove_all</span>(<span class="st">&quot; Ergebnisse&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.integer</span>()</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">n_pages =<span class="st"> </span><span class="kw">ceiling</span>(n_hits<span class="op">/</span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="kw">cat</span>(<span class="kw">paste0</span>(<span class="st">&quot;There are &quot;</span>, n_pages, <span class="st">&quot; pages.&quot;</span>))</a></code></pre></div>
<p>The links are collected from the first result page. We then loop over the remaining result pages and collect the links. All links were written to a text file.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co"># Links from first page</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">links =<span class="st"> </span><span class="kw">read_html</span>(<span class="st">&quot;urbia_search.html&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;h2&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>.[<span class="dv">2</span><span class="op">:</span><span class="dv">11</span>] <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="st">    </span><span class="kw">html_nodes</span>(<span class="st">&quot;a&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_attr</span>(<span class="st">&quot;href&quot;</span>)</a>
<a class="sourceLine" id="cb3-4" data-line-number="4"></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="kw">write_lines</span>(links, <span class="st">&quot;urbia_links.txt&quot;</span>)</a>
<a class="sourceLine" id="cb3-6" data-line-number="6"></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="co"># Links from later pages</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>(n_pages <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)) {</a>
<a class="sourceLine" id="cb3-9" data-line-number="9">    <span class="kw">create_js</span>(<span class="dt">page_number =</span> <span class="kw">paste0</span>(i, <span class="st">&quot;1&quot;</span>))</a>
<a class="sourceLine" id="cb3-10" data-line-number="10">    <span class="kw">system</span>(<span class="st">&quot;phantomjs-2.1.1-macosx/bin/phantomjs tmp.js&quot;</span>)</a>
<a class="sourceLine" id="cb3-11" data-line-number="11">    new_links =<span class="st"> </span><span class="kw">read_html</span>(<span class="st">&quot;urbia_search.html&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;h2&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>.[<span class="dv">2</span><span class="op">:</span><span class="dv">11</span>] <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="st">        </span><span class="kw">html_nodes</span>(<span class="st">&quot;a&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_attr</span>(<span class="st">&quot;href&quot;</span>)</a>
<a class="sourceLine" id="cb3-13" data-line-number="13">    links =<span class="st"> </span><span class="kw">c</span>(links, new_links)</a>
<a class="sourceLine" id="cb3-14" data-line-number="14">    <span class="kw">write_lines</span>(links, <span class="st">&quot;links.txt&quot;</span>)</a>
<a class="sourceLine" id="cb3-15" data-line-number="15">}</a></code></pre></div>
</div>
<div id="collection" class="section level3">
<h3><span class="header-section-number">3.1.2</span> Collection</h3>
<p>Urbia requires a login to access older posts. Username and password have to be set before the web scrape (inspired by this <a href="https://riptutorial.com/r/example/23955/using-rvest-when-login-is-required">source</a>). Note that we used the mobile version of the website (m.urbia.de).</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co"># Address of the login webpage</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2">login =<span class="st"> &quot;https://m.urbia.de/login?go=%2Flogin%3Fgo%3D&quot;</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="co"># create a web session with the desired login address</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5">pgsession =<span class="st"> </span><span class="kw">html_session</span>(login)</a>
<a class="sourceLine" id="cb4-6" data-line-number="6">pgform =<span class="st"> </span><span class="kw">html_form</span>(pgsession)[[<span class="dv">2</span>]]  <span class="co">#in this case the submit is the 2nd form</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7">filled_form =<span class="st"> </span><span class="kw">set_values</span>(pgform, <span class="dt">nick =</span> <span class="st">&quot;XXX&quot;</span>, <span class="dt">pw =</span> <span class="st">&quot;YYY&quot;</span>)</a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="kw">submit_form</span>(pgsession, filled_form)</a></code></pre></div>
<p>Function to collect information on a thread.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">get_thread =<span class="st"> </span><span class="cf">function</span>(link, <span class="dt">wait_time =</span> <span class="dv">0</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>) {</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">    </a>
<a class="sourceLine" id="cb5-3" data-line-number="3">    <span class="cf">if</span> (verbose) </a>
<a class="sourceLine" id="cb5-4" data-line-number="4">        <span class="kw">print</span>(link)</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">    </a>
<a class="sourceLine" id="cb5-6" data-line-number="6">    txt =<span class="st"> </span><span class="kw">read_html</span>(<span class="kw">jump_to</span>(pgsession, <span class="kw">paste0</span>(<span class="st">&quot;https://m.urbia.de&quot;</span>, link)))</a>
<a class="sourceLine" id="cb5-7" data-line-number="7">    </a>
<a class="sourceLine" id="cb5-8" data-line-number="8">    full_link =<span class="st"> </span>txt <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;link&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>.[<span class="dv">1</span>] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_attr</span>(<span class="st">&quot;href&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="st">        </span><span class="kw">str_replace</span>(<span class="st">&quot;https://www&quot;</span>, <span class="st">&quot;https://m&quot;</span>)</a>
<a class="sourceLine" id="cb5-10" data-line-number="10">    </a>
<a class="sourceLine" id="cb5-11" data-line-number="11">    thread_title =<span class="st"> </span>txt <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;main h1&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_text</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_squish</span>()</a>
<a class="sourceLine" id="cb5-12" data-line-number="12">    </a>
<a class="sourceLine" id="cb5-13" data-line-number="13">    subforum =<span class="st"> </span>txt <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;.main&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;span&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>.[<span class="dv">2</span>] <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-14" data-line-number="14"><span class="st">        </span><span class="kw">html_text</span>()</a>
<a class="sourceLine" id="cb5-15" data-line-number="15">    </a>
<a class="sourceLine" id="cb5-16" data-line-number="16">    n_pages =<span class="st"> </span>txt <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;li.current&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>.[<span class="dv">1</span>] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_text</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-17" data-line-number="17"><span class="st">        </span><span class="kw">str_remove</span>(<span class="st">&quot;1 von &quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.integer</span>()</a>
<a class="sourceLine" id="cb5-18" data-line-number="18">    <span class="cf">if</span> (<span class="kw">length</span>(n_pages) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) </a>
<a class="sourceLine" id="cb5-19" data-line-number="19">        n_pages =<span class="st"> </span>1L</a>
<a class="sourceLine" id="cb5-20" data-line-number="20">    </a>
<a class="sourceLine" id="cb5-21" data-line-number="21">    d_out =<span class="st"> </span><span class="kw">get_posts</span>(<span class="dt">text =</span> txt)</a>
<a class="sourceLine" id="cb5-22" data-line-number="22">    </a>
<a class="sourceLine" id="cb5-23" data-line-number="23">    <span class="cf">if</span> (n_pages <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) {</a>
<a class="sourceLine" id="cb5-24" data-line-number="24">        <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span>n_pages) {</a>
<a class="sourceLine" id="cb5-25" data-line-number="25">            <span class="cf">if</span> (verbose) </a>
<a class="sourceLine" id="cb5-26" data-line-number="26">                <span class="kw">print</span>(<span class="kw">paste0</span>(full_link, <span class="st">&quot;?page=&quot;</span>, i))</a>
<a class="sourceLine" id="cb5-27" data-line-number="27">            txt2 =<span class="st"> </span><span class="kw">read_html</span>(<span class="kw">jump_to</span>(pgsession, <span class="kw">paste0</span>(full_link, <span class="st">&quot;?page=&quot;</span>, </a>
<a class="sourceLine" id="cb5-28" data-line-number="28">                i)))</a>
<a class="sourceLine" id="cb5-29" data-line-number="29">            d2 =<span class="st"> </span><span class="kw">get_posts</span>(<span class="dt">text =</span> txt2)</a>
<a class="sourceLine" id="cb5-30" data-line-number="30">            d_out =<span class="st"> </span><span class="kw">bind_rows</span>(d_out, d2)</a>
<a class="sourceLine" id="cb5-31" data-line-number="31">        }</a>
<a class="sourceLine" id="cb5-32" data-line-number="32">    }</a>
<a class="sourceLine" id="cb5-33" data-line-number="33">    </a>
<a class="sourceLine" id="cb5-34" data-line-number="34">    <span class="cf">if</span> (wait_time <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) </a>
<a class="sourceLine" id="cb5-35" data-line-number="35">        <span class="kw">Sys.sleep</span>(wait_time)</a>
<a class="sourceLine" id="cb5-36" data-line-number="36">    </a>
<a class="sourceLine" id="cb5-37" data-line-number="37">    d_out <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">postnumber =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">n</span>(), <span class="dt">thread_title =</span> thread_title, <span class="dt">subforum =</span> subforum, </a>
<a class="sourceLine" id="cb5-38" data-line-number="38">        <span class="dt">n_pages =</span> n_pages, <span class="dt">link =</span> link, <span class="dt">full_link =</span> full_link)</a>
<a class="sourceLine" id="cb5-39" data-line-number="39">}</a></code></pre></div>
<p>Function to collect information on a post (called from within the thread function).</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">get_posts =<span class="st"> </span><span class="cf">function</span>(text) {</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">    posts =<span class="st"> </span>text <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;.main&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;.wrap-text&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_text</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="st">        </span><span class="kw">str_squish</span>()</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">    </a>
<a class="sourceLine" id="cb6-5" data-line-number="5">    author =<span class="st"> </span>text <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;.main&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;.post-author&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="st">        </span><span class="kw">html_text</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_remove</span>(<span class="kw">regex</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">([:print:]+&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_squish</span>()</a>
<a class="sourceLine" id="cb6-7" data-line-number="7">    </a>
<a class="sourceLine" id="cb6-8" data-line-number="8">    postdate =<span class="st"> </span>text <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;.main&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;.post-date&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-9" data-line-number="9"><span class="st">        </span><span class="kw">html_text</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_squish</span>()</a>
<a class="sourceLine" id="cb6-10" data-line-number="10">    </a>
<a class="sourceLine" id="cb6-11" data-line-number="11">    post_reply =<span class="st"> </span>text <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;.main&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;.post-reply-to&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-12" data-line-number="12"><span class="st">        </span><span class="kw">html_text</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_squish</span>()</a>
<a class="sourceLine" id="cb6-13" data-line-number="13">    <span class="cf">if</span> (<span class="kw">length</span>(post_reply) <span class="op">&lt;</span><span class="st"> </span><span class="kw">length</span>(postdate)) {</a>
<a class="sourceLine" id="cb6-14" data-line-number="14">        post_reply =<span class="st"> </span><span class="kw">c</span>(<span class="ot">NA</span>, post_reply)</a>
<a class="sourceLine" id="cb6-15" data-line-number="15">    }</a>
<a class="sourceLine" id="cb6-16" data-line-number="16">    </a>
<a class="sourceLine" id="cb6-17" data-line-number="17">    stars =<span class="st"> </span>text <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;.main&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;span&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_subset</span>(<span class="st">&quot;data-helpful-counter&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-18" data-line-number="18"><span class="st">        </span><span class="kw">str_sub</span>(<span class="dt">start =</span> <span class="dv">28</span>, <span class="dt">end =</span> <span class="dv">-8</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.integer</span>()</a>
<a class="sourceLine" id="cb6-19" data-line-number="19">    <span class="cf">if</span> (<span class="kw">length</span>(stars) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) </a>
<a class="sourceLine" id="cb6-20" data-line-number="20">        stars =<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb6-21" data-line-number="21">    </a>
<a class="sourceLine" id="cb6-22" data-line-number="22">    <span class="kw">tibble</span>(<span class="dt">posts =</span> posts, <span class="dt">author =</span> author, <span class="dt">postdate =</span> postdate, <span class="dt">post_reply =</span> post_reply, </a>
<a class="sourceLine" id="cb6-23" data-line-number="23">        <span class="dt">stars =</span> stars)</a>
<a class="sourceLine" id="cb6-24" data-line-number="24">}</a></code></pre></div>
</div>
</div>
<div id="rund-ums-baby" class="section level2">
<h2><span class="header-section-number">3.2</span> Rund ums Baby</h2>
<div id="search-1" class="section level3">
<h3><span class="header-section-number">3.2.1</span> Search</h3>
<p>The Rund ums Baby discussion board can be searched with the following function.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">get_links =<span class="st"> </span><span class="cf">function</span>(text) {</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">    div =<span class="st"> </span>text <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;div&quot;</span>)</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">    </a>
<a class="sourceLine" id="cb7-4" data-line-number="4">    div2 =<span class="st"> </span>div <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_detect</span>(<span class="kw">fixed</span>(<span class="st">&quot;style=</span><span class="ch">\&quot;</span><span class="st">margin:26px 0px 30px 6px;</span><span class="ch">\&quot;</span><span class="st">&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="st">        </span><span class="kw">which</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">max</span>()</a>
<a class="sourceLine" id="cb7-6" data-line-number="6">    </a>
<a class="sourceLine" id="cb7-7" data-line-number="7">    div[div2] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;a&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_attr</span>(<span class="st">&quot;href&quot;</span>)</a>
<a class="sourceLine" id="cb7-8" data-line-number="8">}</a></code></pre></div>
<p>The search function is called once to identify the number of result pages and to collect the links from the first page.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">txt =<span class="st"> </span><span class="kw">read_html</span>(<span class="st">&quot;https://www.rund-ums-baby.de/suche/index.htm?suchbegriff=impf&amp;kategorie=eltern&amp;seite=1&quot;</span>)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"></a>
<a class="sourceLine" id="cb8-3" data-line-number="3">links =<span class="st"> </span><span class="kw">get_links</span>(txt)</a>
<a class="sourceLine" id="cb8-4" data-line-number="4"></a>
<a class="sourceLine" id="cb8-5" data-line-number="5">n_pages =<span class="st"> </span>txt <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;.suche_navigation&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;a&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_attr</span>(<span class="st">&quot;href&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="st">    </span><span class="kw">str_remove</span>(<span class="kw">fixed</span>(<span class="st">&quot;?suchbegriff=impf&amp;kategorie=eltern&amp;seite=&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.integer</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="st">    </span><span class="kw">max</span>()</a></code></pre></div>
<p>We then loop over the remaining result pages and collect the links. All links were written to a text file.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span>n_pages) {</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">    new_txt =<span class="st"> </span><span class="kw">read_html</span>(<span class="kw">paste0</span>(<span class="st">&quot;https://www.rund-ums-baby.de/suche/index.htm?suchbegriff=impf&amp;kategorie=eltern&amp;seite=&quot;</span>, </a>
<a class="sourceLine" id="cb9-3" data-line-number="3">        i))</a>
<a class="sourceLine" id="cb9-4" data-line-number="4">    new_links =<span class="st"> </span><span class="kw">get_links</span>(new_txt)</a>
<a class="sourceLine" id="cb9-5" data-line-number="5">    links =<span class="st"> </span><span class="kw">c</span>(links, new_links)</a>
<a class="sourceLine" id="cb9-6" data-line-number="6">}</a>
<a class="sourceLine" id="cb9-7" data-line-number="7"></a>
<a class="sourceLine" id="cb9-8" data-line-number="8"><span class="kw">write_lines</span>(<span class="kw">unique</span>(links), <span class="st">&quot;rub_links.txt&quot;</span>)</a></code></pre></div>
</div>
<div id="collection-1" class="section level3">
<h3><span class="header-section-number">3.2.2</span> Collection</h3>
<p>Function to collect all information given the link to the thread.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">get_thread =<span class="st"> </span><span class="cf">function</span>(link, <span class="dt">wait_time =</span> <span class="dv">0</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>) {</a>
<a class="sourceLine" id="cb10-2" data-line-number="2">    </a>
<a class="sourceLine" id="cb10-3" data-line-number="3">    <span class="cf">if</span> (verbose) </a>
<a class="sourceLine" id="cb10-4" data-line-number="4">        <span class="kw">print</span>(link)</a>
<a class="sourceLine" id="cb10-5" data-line-number="5">    </a>
<a class="sourceLine" id="cb10-6" data-line-number="6">    txt =<span class="st"> </span><span class="kw">read_html</span>(<span class="kw">paste0</span>(<span class="st">&quot;https://www.rund-ums-baby.de&quot;</span>, link))</a>
<a class="sourceLine" id="cb10-7" data-line-number="7">    </a>
<a class="sourceLine" id="cb10-8" data-line-number="8">    subforum =<span class="st"> </span>txt <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;.forum_titel&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_text</span>()</a>
<a class="sourceLine" id="cb10-9" data-line-number="9">    </a>
<a class="sourceLine" id="cb10-10" data-line-number="10">    thread_title =<span class="st"> </span>txt <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;#content&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;h1&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_text</span>()</a>
<a class="sourceLine" id="cb10-11" data-line-number="11">    </a>
<a class="sourceLine" id="cb10-12" data-line-number="12">    first_post =<span class="st"> </span>txt <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;#content&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;p.beitrag&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-13" data-line-number="13"><span class="st">        </span><span class="kw">html_text</span>()</a>
<a class="sourceLine" id="cb10-14" data-line-number="14">    </a>
<a class="sourceLine" id="cb10-15" data-line-number="15">    later_posts =<span class="st"> </span>txt <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;#content&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;p.antwort&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-16" data-line-number="16"><span class="st">        </span><span class="kw">html_text</span>()</a>
<a class="sourceLine" id="cb10-17" data-line-number="17">    </a>
<a class="sourceLine" id="cb10-18" data-line-number="18">    posts =<span class="st"> </span><span class="kw">c</span>(first_post, later_posts)</a>
<a class="sourceLine" id="cb10-19" data-line-number="19">    </a>
<a class="sourceLine" id="cb10-20" data-line-number="20">    first_author =<span class="st"> </span>txt <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;#content&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;td:contains(von)&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-21" data-line-number="21"><span class="st">        </span><span class="kw">html_nodes</span>(<span class="st">&quot;b&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_text</span>()</a>
<a class="sourceLine" id="cb10-22" data-line-number="22">    </a>
<a class="sourceLine" id="cb10-23" data-line-number="23">    later_authors =<span class="st"> </span>txt <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;.antwort_von_name&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_text</span>()</a>
<a class="sourceLine" id="cb10-24" data-line-number="24">    </a>
<a class="sourceLine" id="cb10-25" data-line-number="25">    author =<span class="st"> </span><span class="kw">c</span>(first_author, later_authors)</a>
<a class="sourceLine" id="cb10-26" data-line-number="26">    </a>
<a class="sourceLine" id="cb10-27" data-line-number="27">    first_date =<span class="st"> </span>txt <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;#content&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;td:contains(von)&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-28" data-line-number="28"><span class="st">        </span><span class="kw">html_text</span>(<span class="dt">trim =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_remove</span>(<span class="kw">fixed</span>(first_author)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_remove</span>(<span class="st">&quot;von&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-29" data-line-number="29"><span class="st">        </span><span class="kw">str_remove</span>(<span class="st">&quot;am&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_remove</span>(<span class="st">&quot;Geschrieben&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_squish</span>()</a>
<a class="sourceLine" id="cb10-30" data-line-number="30">    </a>
<a class="sourceLine" id="cb10-31" data-line-number="31">    later_dates =<span class="st"> </span>txt <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;p.antwort_von&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_text</span>()</a>
<a class="sourceLine" id="cb10-32" data-line-number="32">    </a>
<a class="sourceLine" id="cb10-33" data-line-number="33">    <span class="cf">if</span> (<span class="kw">length</span>(later_dates) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb10-34" data-line-number="34">        <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(later_dates)) {</a>
<a class="sourceLine" id="cb10-35" data-line-number="35">            later_dates[i] =<span class="st"> </span><span class="kw">str_remove</span>(later_dates[i], <span class="kw">fixed</span>(<span class="kw">paste0</span>(<span class="st">&quot;Antwort von &quot;</span>, </a>
<a class="sourceLine" id="cb10-36" data-line-number="36">                later_authors[i], <span class="st">&quot; am &quot;</span>)))</a>
<a class="sourceLine" id="cb10-37" data-line-number="37">        }</a>
<a class="sourceLine" id="cb10-38" data-line-number="38">    }</a>
<a class="sourceLine" id="cb10-39" data-line-number="39">    </a>
<a class="sourceLine" id="cb10-40" data-line-number="40">    postdate =<span class="st"> </span><span class="kw">c</span>(first_date, later_dates)</a>
<a class="sourceLine" id="cb10-41" data-line-number="41">    </a>
<a class="sourceLine" id="cb10-42" data-line-number="42">    thread_replies =<span class="st"> </span>txt <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;.anzahl_antworten&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_text</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-43" data-line-number="43"><span class="st">        </span><span class="kw">str_remove</span>(<span class="st">&quot; Antwort:&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_remove</span>(<span class="st">&quot; Antworten:&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.integer</span>()</a>
<a class="sourceLine" id="cb10-44" data-line-number="44">    <span class="cf">if</span> (<span class="kw">length</span>(thread_replies) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) </a>
<a class="sourceLine" id="cb10-45" data-line-number="45">        thread_replies =<span class="st"> </span><span class="ot">NA_integer_</span></a>
<a class="sourceLine" id="cb10-46" data-line-number="46">    </a>
<a class="sourceLine" id="cb10-47" data-line-number="47">    <span class="kw">tibble</span>(<span class="dt">posts =</span> posts, <span class="dt">postdate =</span> postdate, <span class="dt">author =</span> author, <span class="dt">thread_replies =</span> thread_replies, </a>
<a class="sourceLine" id="cb10-48" data-line-number="48">        <span class="dt">thread_title =</span> thread_title, <span class="dt">subforum =</span> subforum, <span class="dt">link =</span> link) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">postnumber =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">n</span>())</a>
<a class="sourceLine" id="cb10-49" data-line-number="49">}</a></code></pre></div>
</div>
</div>
<div id="netmoms" class="section level2">
<h2><span class="header-section-number">3.3</span> Netmoms</h2>
<div id="search-2" class="section level3">
<h3><span class="header-section-number">3.3.1</span> Search</h3>
<p>The search results on Netmoms are presented with fixed paginations. Note that we access the static version of the website (static.netmoms.de).</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">txt =<span class="st"> </span><span class="kw">read_html</span>(<span class="st">&quot;https://static.netmoms.de/search/discussion/impf&quot;</span>)</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"></a>
<a class="sourceLine" id="cb11-3" data-line-number="3">result_pages =<span class="st"> </span>txt <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;.jumpToPage&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;option&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="st">    </span><span class="kw">html_attr</span>(<span class="st">&quot;value&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>.[<span class="op">-</span><span class="dv">1</span>]</a></code></pre></div>
<p>The function extracts the links to the threads.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">get_links =<span class="st"> </span><span class="cf">function</span>(text) {</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">    text <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;h6&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;a&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_attr</span>(<span class="st">&quot;href&quot;</span>)</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">}</a></code></pre></div>
<p>We apply the function to the first page and all subsequent pages. All links were written to a text file.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">links =<span class="st"> </span><span class="kw">get_links</span>(txt)</a>
<a class="sourceLine" id="cb13-2" data-line-number="2"></a>
<a class="sourceLine" id="cb13-3" data-line-number="3">links =<span class="st"> </span><span class="kw">c</span>(links, result_pages <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(<span class="op">~</span><span class="kw">get_links</span>(<span class="kw">read_html</span>(.x))))</a>
<a class="sourceLine" id="cb13-4" data-line-number="4"></a>
<a class="sourceLine" id="cb13-5" data-line-number="5"><span class="kw">write_lines</span>(<span class="kw">unlist</span>(links), <span class="st">&quot;netmoms_links.txt&quot;</span>)</a></code></pre></div>
</div>
<div id="collection-2" class="section level3">
<h3><span class="header-section-number">3.3.2</span> Collection</h3>
<p>Function to collect information on a thread.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">get_thread =<span class="st"> </span><span class="cf">function</span>(link, <span class="dt">wait_time =</span> <span class="dv">0</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>) {</a>
<a class="sourceLine" id="cb14-2" data-line-number="2">    </a>
<a class="sourceLine" id="cb14-3" data-line-number="3">    <span class="cf">if</span> (verbose) </a>
<a class="sourceLine" id="cb14-4" data-line-number="4">        <span class="kw">print</span>(link)</a>
<a class="sourceLine" id="cb14-5" data-line-number="5">    </a>
<a class="sourceLine" id="cb14-6" data-line-number="6">    txt =<span class="st"> </span><span class="kw">read_html</span>(<span class="kw">paste0</span>(<span class="st">&quot;https://www.netmoms.de&quot;</span>, link))</a>
<a class="sourceLine" id="cb14-7" data-line-number="7">    </a>
<a class="sourceLine" id="cb14-8" data-line-number="8">    next_replies =<span class="st"> </span>txt <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;.jumpToPage&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;option&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb14-9" data-line-number="9"><span class="st">        </span><span class="kw">html_attr</span>(<span class="st">&quot;value&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unique</span>() <span class="op">%&gt;%</span><span class="st"> </span>.[<span class="op">-</span><span class="dv">1</span>]</a>
<a class="sourceLine" id="cb14-10" data-line-number="10">    </a>
<a class="sourceLine" id="cb14-11" data-line-number="11">    subforum =<span class="st"> </span>txt <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;h1&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>.[<span class="dv">1</span>] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_text</span>()</a>
<a class="sourceLine" id="cb14-12" data-line-number="12">    </a>
<a class="sourceLine" id="cb14-13" data-line-number="13">    thread_title =<span class="st"> </span>txt <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;h1&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>.[<span class="dv">2</span>] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_text</span>(<span class="dt">trim =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb14-14" data-line-number="14">    </a>
<a class="sourceLine" id="cb14-15" data-line-number="15">    thread_visits =<span class="st"> </span>txt <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;.tooltip-info&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_text</span>(<span class="dt">trim =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb14-16" data-line-number="16"><span class="st">        </span><span class="kw">as.integer</span>() <span class="op">%&gt;%</span><span class="st"> </span>.[<span class="op">!</span><span class="kw">is.na</span>(.)] <span class="op">%&gt;%</span><span class="st"> </span>.[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb14-17" data-line-number="17">    </a>
<a class="sourceLine" id="cb14-18" data-line-number="18">    thread_replies =<span class="st"> </span>txt <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;.tooltip-info&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_text</span>(<span class="dt">trim =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb14-19" data-line-number="19"><span class="st">        </span><span class="kw">as.integer</span>() <span class="op">%&gt;%</span><span class="st"> </span>.[<span class="op">!</span><span class="kw">is.na</span>(.)] <span class="op">%&gt;%</span><span class="st"> </span>.[<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb14-20" data-line-number="20">    </a>
<a class="sourceLine" id="cb14-21" data-line-number="21">    d_out =<span class="st"> </span><span class="kw">get_posts</span>(<span class="dt">text =</span> txt)</a>
<a class="sourceLine" id="cb14-22" data-line-number="22">    </a>
<a class="sourceLine" id="cb14-23" data-line-number="23">    <span class="cf">if</span> (<span class="kw">length</span>(next_replies) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb14-24" data-line-number="24">        d_out2 =<span class="st"> </span>next_replies <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_df</span>(<span class="op">~</span><span class="kw">get_posts</span>(<span class="dt">text =</span> <span class="kw">read_html</span>(.x)))</a>
<a class="sourceLine" id="cb14-25" data-line-number="25">    } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb14-26" data-line-number="26">        d_out2 =<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb14-27" data-line-number="27">    }</a>
<a class="sourceLine" id="cb14-28" data-line-number="28">    </a>
<a class="sourceLine" id="cb14-29" data-line-number="29">    d_out <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">bind_rows</span>(d_out2) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">postnumber =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">n</span>(), <span class="dt">subforum =</span> subforum, </a>
<a class="sourceLine" id="cb14-30" data-line-number="30">        <span class="dt">thread_title =</span> thread_title, <span class="dt">thread_visits =</span> thread_visits, <span class="dt">thread_replies =</span> thread_replies, </a>
<a class="sourceLine" id="cb14-31" data-line-number="31">        <span class="dt">n_pages =</span> <span class="kw">length</span>(next_replies) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">link =</span> link)</a>
<a class="sourceLine" id="cb14-32" data-line-number="32">}</a></code></pre></div>
<p>Function to collect information on a post (called from within the thread function).</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">get_posts =<span class="st"> </span><span class="cf">function</span>(text) {</a>
<a class="sourceLine" id="cb15-2" data-line-number="2">    </a>
<a class="sourceLine" id="cb15-3" data-line-number="3">    first_post =<span class="st"> </span>text <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;.first-post&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;.bodytext&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb15-4" data-line-number="4"><span class="st">        </span><span class="kw">html_text</span>(<span class="dt">trim =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb15-5" data-line-number="5">    <span class="cf">if</span> (<span class="kw">length</span>(first_post) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) </a>
<a class="sourceLine" id="cb15-6" data-line-number="6">        first_post =<span class="st"> </span><span class="ot">NA_character_</span></a>
<a class="sourceLine" id="cb15-7" data-line-number="7">    </a>
<a class="sourceLine" id="cb15-8" data-line-number="8">    later_posts =<span class="st"> </span>text <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;.activitiy-item&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;.bodytext&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb15-9" data-line-number="9"><span class="st">        </span><span class="kw">html_text</span>(<span class="dt">trim =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb15-10" data-line-number="10">    <span class="cf">if</span> (<span class="kw">length</span>(later_posts) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) </a>
<a class="sourceLine" id="cb15-11" data-line-number="11">        later_posts =<span class="st"> </span><span class="ot">NA_character_</span></a>
<a class="sourceLine" id="cb15-12" data-line-number="12">    </a>
<a class="sourceLine" id="cb15-13" data-line-number="13">    posts =<span class="st"> </span><span class="kw">c</span>(first_post, later_posts)</a>
<a class="sourceLine" id="cb15-14" data-line-number="14">    </a>
<a class="sourceLine" id="cb15-15" data-line-number="15">    author =<span class="st"> </span>text <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;.owner-info&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(<span class="op">~</span><span class="kw">html_nodes</span>(.x, <span class="st">&quot;.link-to-user&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb15-16" data-line-number="16"><span class="st">        </span><span class="kw">map_chr</span>(<span class="op">~</span><span class="kw">ifelse</span>(<span class="kw">length</span>(.x) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, <span class="st">&quot;Gelöschte NetMom&quot;</span>, <span class="kw">html_text</span>(.x)))</a>
<a class="sourceLine" id="cb15-17" data-line-number="17">    </a>
<a class="sourceLine" id="cb15-18" data-line-number="18">    postdate =<span class="st"> </span>text <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;.sl-0&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_text</span>()</a>
<a class="sourceLine" id="cb15-19" data-line-number="19">    </a>
<a class="sourceLine" id="cb15-20" data-line-number="20">    expert =<span class="st"> </span>text <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;.owner-info&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_node</span>(<span class="st">&quot;.status-expert&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb15-21" data-line-number="21"><span class="st">        </span><span class="kw">as.character</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_detect</span>(<span class="st">&quot;expert&quot;</span>)</a>
<a class="sourceLine" id="cb15-22" data-line-number="22">    </a>
<a class="sourceLine" id="cb15-23" data-line-number="23">    <span class="kw">tibble</span>(<span class="dt">posts =</span> posts, <span class="dt">author =</span> author, <span class="dt">postdate =</span> postdate, <span class="dt">expert =</span> expert)</a>
<a class="sourceLine" id="cb15-24" data-line-number="24">}</a></code></pre></div>
</div>
</div>
<div id="babycenter" class="section level2">
<h2><span class="header-section-number">3.4</span> Babycenter</h2>
<p>Babycenter was by far the hardest platform for the data collection. The conversation style differed from the other communities, which were more similar to traditional discussion boards with topically organized threads. The discussions on Babycenter were more similar to a group chat in which multiple topics were discussed in the same thread. This resulted in much more threads with the search term and in much longer threads. Many posts were irrelevant for our research interest and had to be sorted out later on (see Section <a href="data-preparation.html#data-preparation">5</a>).</p>
<div id="search-3" class="section level3">
<h3><span class="header-section-number">3.4.1</span> Search</h3>
<p>We read the first result page. We extract the links from the first page and the number of search results. We calculate the number of result pages from the latter.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">txt =<span class="st"> </span><span class="kw">read_html</span>(<span class="st">&quot;https://www.babycenter.de/search?q=impf&amp;filterQuery=content_bucket:community_comment&quot;</span>)</a>
<a class="sourceLine" id="cb16-2" data-line-number="2"></a>
<a class="sourceLine" id="cb16-3" data-line-number="3">int_links =<span class="st"> </span>txt <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;.searchLink&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_attr</span>(<span class="st">&quot;href&quot;</span>)</a>
<a class="sourceLine" id="cb16-4" data-line-number="4"></a>
<a class="sourceLine" id="cb16-5" data-line-number="5">links =<span class="st"> </span>int_links <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_chr</span>(<span class="op">~</span><span class="kw">get_canonicallink</span>(<span class="dt">link =</span> .x))</a>
<a class="sourceLine" id="cb16-6" data-line-number="6"></a>
<a class="sourceLine" id="cb16-7" data-line-number="7">n_results =<span class="st"> </span>txt <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;h1&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_node</span>(<span class="st">&quot;strong&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_text</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb16-8" data-line-number="8"><span class="st">    </span><span class="kw">str_remove</span>(<span class="kw">fixed</span>(<span class="st">&quot;.&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.integer</span>()</a>
<a class="sourceLine" id="cb16-9" data-line-number="9"></a>
<a class="sourceLine" id="cb16-10" data-line-number="10">n_pages =<span class="st"> </span><span class="kw">ceiling</span>(n_results<span class="op">/</span><span class="dv">10</span>)</a></code></pre></div>
<p>The function extracts the links to the threads. The safe version prevents an abortion of the search loop in case of an error.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">get_canonicallink =<span class="st"> </span><span class="cf">function</span>(link) {</a>
<a class="sourceLine" id="cb17-2" data-line-number="2">    </a>
<a class="sourceLine" id="cb17-3" data-line-number="3">    canlink =<span class="st"> </span><span class="kw">read_html</span>(<span class="kw">paste0</span>(<span class="st">&quot;https://www.babycenter.de&quot;</span>, link)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;head&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-4" data-line-number="4"><span class="st">        </span><span class="kw">html_nodes</span>(<span class="st">&quot;link[rel=</span><span class="ch">\&quot;</span><span class="st">canonical</span><span class="ch">\&quot;</span><span class="st">]&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_attr</span>(<span class="st">&quot;href&quot;</span>)</a>
<a class="sourceLine" id="cb17-5" data-line-number="5">    <span class="cf">if</span> (<span class="kw">str_detect</span>(canlink, <span class="kw">fixed</span>(<span class="st">&quot;?&quot;</span>))) {</a>
<a class="sourceLine" id="cb17-6" data-line-number="6">        canlink =<span class="st"> </span>canlink <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_sub</span>(<span class="dt">end =</span> <span class="kw">str_locate</span>(., <span class="kw">fixed</span>(<span class="st">&quot;?&quot;</span>))[, <span class="dv">1</span>] <span class="op">-</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-7" data-line-number="7"><span class="st">            </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb17-8" data-line-number="8">    }</a>
<a class="sourceLine" id="cb17-9" data-line-number="9">    canlink</a>
<a class="sourceLine" id="cb17-10" data-line-number="10">}</a>
<a class="sourceLine" id="cb17-11" data-line-number="11"></a>
<a class="sourceLine" id="cb17-12" data-line-number="12">safe_get_canonicallink =<span class="st"> </span><span class="kw">safely</span>(<span class="dt">.f =</span> get_canonicallink, <span class="dt">otherwise =</span> <span class="ot">NA_character_</span>)</a></code></pre></div>
<p>We loop over all subsequent result pages. All links were written to a text file.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>(n_pages <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)) {</a>
<a class="sourceLine" id="cb18-2" data-line-number="2">    <span class="kw">print</span>(i)</a>
<a class="sourceLine" id="cb18-3" data-line-number="3">    </a>
<a class="sourceLine" id="cb18-4" data-line-number="4">    txt2 =<span class="st"> </span><span class="kw">read_html</span>(<span class="kw">paste0</span>(<span class="st">&quot;https://www.babycenter.de/search?startIndex=&quot;</span>, </a>
<a class="sourceLine" id="cb18-5" data-line-number="5">        i, <span class="st">&quot;0&amp;q=impf&amp;filterQuery=content_bucket:community_comment&quot;</span>))</a>
<a class="sourceLine" id="cb18-6" data-line-number="6">    </a>
<a class="sourceLine" id="cb18-7" data-line-number="7">    new_int_links =<span class="st"> </span>txt2 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;.searchLink&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_attr</span>(<span class="st">&quot;href&quot;</span>)</a>
<a class="sourceLine" id="cb18-8" data-line-number="8">    </a>
<a class="sourceLine" id="cb18-9" data-line-number="9">    new_links =<span class="st"> </span>new_int_links <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_chr</span>(<span class="op">~</span><span class="kw">safe_get_canonicallink</span>(<span class="dt">link =</span> .x)<span class="op">$</span>result)</a>
<a class="sourceLine" id="cb18-10" data-line-number="10">    </a>
<a class="sourceLine" id="cb18-11" data-line-number="11">    int_links =<span class="st"> </span><span class="kw">c</span>(int_links, new_int_links)</a>
<a class="sourceLine" id="cb18-12" data-line-number="12">    links =<span class="st"> </span><span class="kw">c</span>(links, new_links)</a>
<a class="sourceLine" id="cb18-13" data-line-number="13">    </a>
<a class="sourceLine" id="cb18-14" data-line-number="14">    <span class="kw">Sys.sleep</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb18-15" data-line-number="15">}</a>
<a class="sourceLine" id="cb18-16" data-line-number="16"></a>
<a class="sourceLine" id="cb18-17" data-line-number="17"><span class="kw">write_lines</span>(links, <span class="st">&quot;bc_links.txt&quot;</span>)</a></code></pre></div>
</div>
<div id="collection-3" class="section level3">
<h3><span class="header-section-number">3.4.2</span> Collection</h3>
<p>Function to collect information on a thread.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">get_thread =<span class="st"> </span><span class="cf">function</span>(link, <span class="dt">wait_time =</span> <span class="dv">0</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>) {</a>
<a class="sourceLine" id="cb19-2" data-line-number="2">    </a>
<a class="sourceLine" id="cb19-3" data-line-number="3">    <span class="cf">if</span> (verbose) </a>
<a class="sourceLine" id="cb19-4" data-line-number="4">        <span class="kw">print</span>(link)</a>
<a class="sourceLine" id="cb19-5" data-line-number="5">    </a>
<a class="sourceLine" id="cb19-6" data-line-number="6">    txt =<span class="st"> </span><span class="kw">read_html</span>(link)</a>
<a class="sourceLine" id="cb19-7" data-line-number="7">    </a>
<a class="sourceLine" id="cb19-8" data-line-number="8">    n_pages =<span class="st"> </span>txt <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;.firstLast&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;a&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_attr</span>(<span class="st">&quot;href&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-9" data-line-number="9"><span class="st">        </span><span class="kw">str_sub</span>(<span class="dt">start =</span> <span class="kw">str_locate</span>(., <span class="kw">fixed</span>(<span class="st">&quot;startIndex=&quot;</span>))[, <span class="dv">2</span>] <span class="op">+</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.integer</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-10" data-line-number="10"><span class="st">        </span><span class="kw">I</span>(.)<span class="op">/</span><span class="dv">10</span></a>
<a class="sourceLine" id="cb19-11" data-line-number="11">    <span class="cf">if</span> (<span class="kw">length</span>(n_pages) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) </a>
<a class="sourceLine" id="cb19-12" data-line-number="12">        n_pages =<span class="st"> </span><span class="ot">NA_integer_</span></a>
<a class="sourceLine" id="cb19-13" data-line-number="13">    </a>
<a class="sourceLine" id="cb19-14" data-line-number="14">    thread_title =<span class="st"> </span>txt <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;h1&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_text</span>(<span class="dt">trim =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb19-15" data-line-number="15">    </a>
<a class="sourceLine" id="cb19-16" data-line-number="16">    subforum =<span class="st"> </span>txt <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;#groupLink&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_text</span>()</a>
<a class="sourceLine" id="cb19-17" data-line-number="17">    </a>
<a class="sourceLine" id="cb19-18" data-line-number="18">    posts =<span class="st"> </span><span class="kw">get_posts</span>(txt)</a>
<a class="sourceLine" id="cb19-19" data-line-number="19">    </a>
<a class="sourceLine" id="cb19-20" data-line-number="20">    <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.na</span>(n_pages)) {</a>
<a class="sourceLine" id="cb19-21" data-line-number="21">        <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n_pages) {</a>
<a class="sourceLine" id="cb19-22" data-line-number="22">            <span class="cf">if</span> (verbose) </a>
<a class="sourceLine" id="cb19-23" data-line-number="23">                <span class="kw">print</span>(i)</a>
<a class="sourceLine" id="cb19-24" data-line-number="24">            txt2 =<span class="st"> </span><span class="kw">read_html</span>(<span class="kw">paste0</span>(link, <span class="st">&quot;?startIndex=&quot;</span>, i, <span class="st">&quot;0&quot;</span>))</a>
<a class="sourceLine" id="cb19-25" data-line-number="25">            posts2 =<span class="st"> </span><span class="kw">get_posts</span>(txt2)</a>
<a class="sourceLine" id="cb19-26" data-line-number="26">            posts =<span class="st"> </span><span class="kw">bind_rows</span>(posts, posts2)</a>
<a class="sourceLine" id="cb19-27" data-line-number="27">            <span class="kw">Sys.sleep</span>(wait_time)</a>
<a class="sourceLine" id="cb19-28" data-line-number="28">        }</a>
<a class="sourceLine" id="cb19-29" data-line-number="29">    }</a>
<a class="sourceLine" id="cb19-30" data-line-number="30">    posts <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">postnumer =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">n</span>(), <span class="dt">thread_title =</span> thread_title, <span class="dt">subforum =</span> subforum, </a>
<a class="sourceLine" id="cb19-31" data-line-number="31">        <span class="dt">n_pages =</span> n_pages, <span class="dt">link =</span> link)</a>
<a class="sourceLine" id="cb19-32" data-line-number="32">}</a></code></pre></div>
<p>Function to collect information on a post (called from within the thread function).</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">get_posts =<span class="st"> </span><span class="cf">function</span>(text) {</a>
<a class="sourceLine" id="cb20-2" data-line-number="2">    posts =<span class="st"> </span>text <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;.postContent&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;.bodyText&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb20-3" data-line-number="3"><span class="st">        </span><span class="kw">html_text</span>(<span class="dt">trim =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb20-4" data-line-number="4">    </a>
<a class="sourceLine" id="cb20-5" data-line-number="5">    first_author =<span class="st"> </span>text <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;.postInfo&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>.[<span class="dv">1</span>] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_text</span>(<span class="dt">trim =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb20-6" data-line-number="6"><span class="st">        </span><span class="kw">str_split</span>(<span class="st">&quot;[:space:]&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>.[[<span class="dv">1</span>]] <span class="op">%&gt;%</span><span class="st"> </span>.[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb20-7" data-line-number="7">    </a>
<a class="sourceLine" id="cb20-8" data-line-number="8">    later_authors =<span class="st"> </span>text <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;.postInfo&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;.commentCreator&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb20-9" data-line-number="9"><span class="st">        </span><span class="kw">html_text</span>(<span class="dt">trim =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_remove</span>(<span class="kw">fixed</span>(<span class="st">&quot;Ursprünglicher Verfasser&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb20-10" data-line-number="10"><span class="st">        </span><span class="kw">str_squish</span>()</a>
<a class="sourceLine" id="cb20-11" data-line-number="11">    </a>
<a class="sourceLine" id="cb20-12" data-line-number="12">    authors =<span class="st"> </span><span class="kw">c</span>(first_author, later_authors)</a>
<a class="sourceLine" id="cb20-13" data-line-number="13">    </a>
<a class="sourceLine" id="cb20-14" data-line-number="14">    postdate =<span class="st"> </span>text <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;.postInfo&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>.[<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(authors)] <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb20-15" data-line-number="15"><span class="st">        </span><span class="kw">html_text</span>(<span class="dt">trim =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_remove</span>(<span class="kw">fixed</span>(<span class="st">&quot;Ursprünglicher Verfasser&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb20-16" data-line-number="16"><span class="st">        </span><span class="kw">str_squish</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_split</span>(<span class="st">&quot;[:space:]&quot;</span>, <span class="dt">simplify =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span>.[, <span class="dv">2</span>]</a>
<a class="sourceLine" id="cb20-17" data-line-number="17">    </a>
<a class="sourceLine" id="cb20-18" data-line-number="18">    likes =<span class="st"> </span>text <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;.likeCount&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_text</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.integer</span>()</a>
<a class="sourceLine" id="cb20-19" data-line-number="19">    </a>
<a class="sourceLine" id="cb20-20" data-line-number="20">    <span class="kw">tibble</span>(<span class="dt">posts =</span> posts, <span class="dt">postdate =</span> postdate, <span class="dt">authors =</span> authors, <span class="dt">likes =</span> likes)</a>
<a class="sourceLine" id="cb20-21" data-line-number="21">}</a></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="selection-of-online-communities.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="data-selection.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
